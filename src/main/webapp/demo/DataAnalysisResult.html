<html>
<head>
    <title>Data Analysis Result Test Page</title>
    <style type="text/css">
        body {
        font: 8pt helvetica neue;
        color: #666;
        }
        td {
        font: 8pt helvetica neue;
        color: #666;
        }
        input {
        font: 8pt helvetica neue;


        }
        .outlined {
            color: #666;
            border-color: #F5F5F5;
            border-width: 2px 2px 2px 2px;
            border-style: solid;
            border-spacing: 0px;

            }
    </style>
    <link rel="stylesheet" type="text/css" href="/addama/ui/ext-js-3.2.1/resources/css/ext-all.css">
    <link rel="stylesheet" type="text/css" href="/addama/ui/ext-js-3.2.1/examples/shared/examples.css"/>
    <link rel="stylesheet" type="text/css" href="/addama/ui/ext-js-3.2.1/examples/ux/treegrid/treegrid.css"/>
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("prototype", "1.6.1.0");
        google.load("visualization", "1", {packages:["table"]});
		</script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/ext-all.js"></script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/examples/ux/treegrid/TreeGridSorter.js"></script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/examples/ux/treegrid/TreeGridColumnResizer.js"></script>
    <script type="text/javascript" src="js/TreeGridNodeUI.js"></script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/examples/ux/treegrid/TreeGridLoader.js"></script>

    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/examples/ux/treegrid/TreeGridColumns.js"></script>
    <script type="text/javascript" src="/addama/ui/ext-js-3.2.1/examples/ux/treegrid/TreeGrid.js"></script>
     <script type="text/javascript" language="javascript" src="/addama/ui/protovis-r3.2.js"></script>
       <script type="text/javascript" language="javascript" src="/addama/ui/visdata.js"></script>
       <script type="text/javascript" language="javascript" src="/addama/ui/flexscroll.js"></script>
    <script type="text/javascript" src="/addama/ui/refgenome/js/chromosomeRangeControl.js"></script>
    <script type="text/javascript" src="js/patientSelectorControl.js"></script>
    <script type="text/javascript" src="js/transplantVisualization.js"></script>
    <script type="text/javascript" src="js/transplant.js"></script>
    <script type="text/javascript" src="js/trackQuery.js"></script>
    <script type="text/javascript" src="js/patientGeneScoresQuery.js"></script>

    <script type="text/javascript">
        var  dataResult;
        var patientSelector;
        var workspaceUri ="";
        var refGenomeUri = "/addama/refgenome/hg18";
        var rangeControl;
        var visualizationControl;
        var trackQueryControl;
        var geneScoreQueryControl;
        var transplantParameters;

        Ext.onReady(function(){

            Ext.QuickTips.init();
            isLoggedIn(loadData);

        });

        function loadData(){

            var queryString = decodeURI(window.location.search.substring(1));
                var queryParams = queryString.toQueryParams();
                workspaceUri = queryParams["workspace"];

            patientSelector = new PatientSelectorControl("container_patientBrowser",workspaceUri);
            rangeControl = new ChromosomeRangeControl("container_rangeControl",refGenomeUri);
            visualizationControl = new TransplantVisualization("container_visualization",refGenomeUri,workspaceUri +"/track.tsv");
            trackQueryControl = new TrackQuery("container_trackquery",workspaceUri);
            geneScoreQueryControl = new GeneScoresQuery("container_patientscores",workspaceUri,refGenomeUri);
            transplantParameters = new TransplantParameters();

            rangeControl.addSelectionListener(visualizationControl);
            rangeControl.addSelectionListener(trackQueryControl);
            rangeControl.addSelectionListener(geneScoreQueryControl);

            patientSelector.addSelectionListener(visualizationControl);
            patientSelector.addSelectionListener(trackQueryControl);
            patientSelector.addSelectionListener(geneScoreQueryControl);

            transplantParameters.addListener(visualizationControl);


             var tabPanel = new Ext.TabPanel({
            region: 'center',
            activeTab:0,
            width:"100%",
            height:800,
            renderTo: $("container_tabPanel"),
            items:[{
                contentEl: $("container_patientBrowser"),
                title: 'Patient Selection',
                closable: false,
                autoScroll: true
            },{
                contentEl: $("container_visualization"),
                title: 'Visualizations',
                closable: false,
                autoScroll: true
            },{
                contentEl: $("container_trackquery"),
                title: 'Track Query',
                closable: false,
                autoScroll: true
            },{
                contentEl: $("container_patientscores"),
                title: 'Patient Gene Scores Query',
                closable: false,
                autoScroll: true
            }]
        });

        new Ext.Viewport({
            layout: 'border',
            width: "100%",
            height: "100%",
            items:[{
                region: 'north',
                collapsible: true,
                split: true,
                autoHeight: true,
                width: "100%",
                expanded: true,
                collapseMode:'mini',
                items:[{
                    contentEl: $("container_rangeControl")
                }],
                renderTo: $("container_north")
            },tabPanel],
            renderTo: $("container_main")

        }).show();

        }

        function isLoggedIn(callback) {
                new Ajax.Request("/addama/users/whoami", {
                    method: "get",
                    onSuccess: function(o) {
                        var json = o.responseJSON;
                        if (json && json.email) {
                            loggedInUser = json.email;
                        }

                        callback();
                    }
                });
            }

        function loadVisualizationParameters(){
            transplantParameters.show();
        }

    </script>
</head>
<body>
    <div id="container_main">
        <div id="container_whoami"></div>
        <div id="container_tree" class="x-hidden"></div>
        <div id="container_north">
        <div id="container_rangeControl">
        </div>
        <div id="container_patientBrowser"></div>
        </div>
        <div id="container_tabPanel">
            <div id="container_visualization" class="x-hidden"></div>
            <div id="container_trackquery" class="x-hidden"></div>
            <div id="container_patientscores" class="x-hidden"></div>
        </div>
    </div>
<div id="container_msg"></div>
</body>
</html>